## Домашнее задание к занятию "5.5. Оркестрация кластером Docker контейнеров на примере Docker Swarm"

### Задача 1: Дайте письменные ответы на следующие вопросы:

Дайте письменные ответы на следующие вопросы:

- В чём отличие режимов работы сервисов в Docker Swarm кластере: replication и global?

__Ответ__

В режиме  `replication`  необходимо указывать число реплик (сервисов), которые будут распределены между устройствами кластера. В режиме  `global`  сервис автоматически запустится на всех доступных устройствах кластера.

---

- Какой алгоритм выбора лидера используется в Docker Swarm кластере?

__Ответ__

Docker Swarm кластер использует алгоритм RAFT, который обеспечивает безопасную и эффективную реализацию для управления глобальным состоянием менеджеров кластера и выбора лидера. Raft допускает (N-1)/2 потерь менеджмент узлов и требует, чтобы большинство или кворум (N/2)+1 членов согласились на значения, предлагаемые кластеру. Например, если в кластере из 5 менеджеров 3 узла недоступны, то система не сможет больше обрабатывать запросы на планирование дополнительных задач и балансировку, хотя существующие задачи продолжат выполняться. Среди менеджеров выбирается лидер, его задача гарантировать согласованность. Лидер отправляет `keepalive` пакеты с заданной периодичностью и если пакеты не пришли, менеджеры начинают выборы нового лидера.

---

- Что такое Overlay Network?

__Ответ__

Распределенная сеть между множественными хостами Docker для использования сервисами. В Swarm по умолчанию используется сеть типа overlay с именем ingress для распределения нагрузки, а так же сеть типа bridge с названием docker_gwbridge для коммуникации самих Docker daemon.

---

### Задача 2: Создать ваш первый Docker Swarm кластер в Яндекс.Облаке

Создать ваш первый Docker Swarm кластер в Яндекс.Облаке

Для получения зачета, вам необходимо предоставить скриншот из терминала (консоли), с выводом команды:
```
docker node ls
```

__Вывод_из_терминала__

![Задача 2](/HomeWork/virt-homeworks/05-virt-05-docker-swarm/img/docker-node.png)

### Задача 3: Создать ваш первый, готовый к боевой эксплуатации кластер мониторинга, состоящий из стека микросервисов.

Создать ваш первый, готовый к боевой эксплуатации кластер мониторинга, состоящий из стека микросервисов.

Для получения зачета, вам необходимо предоставить скриншот из терминала (консоли), с выводом команды:
```
docker service ls
```

__Вывод_из_терминала__

![Задача 3](/HomeWork/virt-homeworks/05-virt-05-docker-swarm/img/docker-service.png)

### Задача 4 (*): Выполнить на лидере Docker Swarm кластера команду (указанную ниже) и дать письменное описание её функционала, что она делает и зачем она нужна:
```
# см.документацию: https://docs.docker.com/engine/swarm/swarm_manager_locking/
docker swarm update --autolock=true
```

__Ответ__

Данная команда шифрует сертификаты всех нод дополнительным ключём. Когда демон Docker перезапускается, ключ TLS, используемый для шифрования связи между узлами кластера, и ключ, используемый для шифрования и расшифровки журналов Raft на диске, загружаются в память каждого узла менеджера. Если ключи не защищены, то злоумышленник может получить доступ к [Docker secrets](https://docs.docker.com/engine/swarm/secrets/). Docker позволяет защитить ключи и требовать ручную разблокировку узла кластера. Эта функция называется автоблокировкой и включается при инициализации кластера командой `docker swarm init --autolock` или параметр можно включить на работающем кластере командой `docker swarm update --autolock=true`, при этом ключ разблокировки будет включен в вывод команды. После включения автоблокировки при попытке перезапуска Docker `sudo service docker restart`, если мы попытаемся обратится к службе, например `docker service ls` получим сообщение "Error response from daemon: Swarm is encrypted and needs to be unlocked before it can be used. Please use "docker swarm unlock" to unlock it." и для работы службы в составе кластера нам нужно будет разблокировать ключ командой `docker swarm unlock`. Для просмотра ключа используется команда `docker swarm unlock-key`, для смены `docker swarm unlock-key --rotate`.

---
